基于企业微信的机器人购物平台

# 表格逻辑

管理员表administrator	//没用上

员工表staff

商品表commodity

订单表commodity_order

签到表check_in

匹配失败的土味情话no_match_msg

帮助表help_list





# 运行逻辑

##### 定位匹配：

如果有设置，每5秒会获取一次定位信息，已屏蔽忽略



##### 用户账户匹配：

确定进入用户，若是新用户，则生成新用户



###### 维护状态：已注释，用户进入及任意对话时，回复“维护中，请稍后”



##### 用户进入匹配：

staff进入企业微信，后台收到“进入”消息，发送消息



##### 文字内容匹配：

提取用户发送的内容，进行匹配



##### 1.帮助

从help_list中获取帮助列表



##### 2.我的积分

从staff表中获取用户积分



##### 3.打开商城

从commodity表中获取商品信息



##### 4.我的订单

根据当前账户，从commodity_order表中获取个人订单



##### 5.查询订单xxx

查找订单号是否存在

匹配订单用户是否为当前会话账户

返回订单信息



##### 6.签到

对当前日期和当前用户进行查找，是否已签到

未签到则新增数据



##### 7.签到表

根据当前账户，查找签到历史记录



##### 8.购买商品xx

商品号是否正确

商品是否充足

积分是否充足

商品-1，积分-n，创建订单成功

查找当前用户最新订单，返回订单号为xxxxx

发邮件给管理员



##### 撤销订单xx

订单号是否正确

查个人所有订单判断用户自身权限，不可撤销他人订单

已完成订单不可以撤销

用户积分+n，商品+1，订单状态改变撤销订单成功

发邮件给管理员



##### 匹配失败：

在no_match_msg表中随机获取一条进行返回



# 指令

帮助：各种指令

我的积分

我的订单

打开商城

签到

签到表

查询订单xxxx

撤销订单xxxx

积分变动记录（每月赠送积分是负责人在后台直接加的。这里记录签到情况即可）

购买商品1（每个物品只能单买，甲方说商品要限购抢购）



# 年-月-日.log

记录用户进入和 会话对话内容



